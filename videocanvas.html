<!doctype html>
<html lang="en">
<head>
<!-- from http://jsfiddle.net/AbdiasSoftware/a8g4n/ -->
    
   <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
   <meta charset="utf-8" />
   <title>HTML5 video canvas playlist</title> 
   <script>

        video1 = document.createElement('video');
        video2 = document.createElement('video');
        isVideo1 = false;
        list = [];
        current = 0;
        isPlaying = false;
       
    $( document ).ready(function() {
        
        var canvas = document.getElementById("viewport");
        var ctx = canvas.getContext('2d');
        w = canvas.width;
        h = canvas.height;
        wm = document.createElement('canvas');
        wctx = wm.getContext('2d');
        wtxt = 'video search results demo';
        var video_preview_duration = 2;

        initialize_videoplayer();
    
    window.requestAnimationFrame = (function(){
      return  window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame    ||
              function( callback ){
                window.setTimeout(callback, 1000 / 60);
              };
    })();
    
    function initialize_videoplayer() {
       
        wm.width = 380;
        wm.height = 20;
        wctx.font = 'bold 20px Arial';
        wctx.fillStyle = 'rgba(255,255,255, 0.5)';
        wctx.textBaseline = 'top';
        wctx.fillText(wtxt, 0, 0);
        
        //video1.addEventListener('ended', play, false);
        //video2.addEventListener('ended', play, false);
        
        video1.ontimeupdate = function(event) {onTrackedVideoFrame(this.currentTime, this.duration)};
        video2.ontimeupdate = function(event) {onTrackedVideoFrame(this.currentTime, this.duration)};
    
        // addVideo('http://www.w3schools.com/html/mov_bbb.mp4', 'http://www.w3schools.com/html/mov_bbb.ogg');
        // addVideo('http://media.sublimevideo.net/v/next15-sublime_360p.mp4', 'http://media.sublimevideo.net/v/next15-sublime_360p.webm');
        
        addVideo("http://ak8.picdn.net/shutterstock/videos/3711827/preview/stock-footage-high-quality-looping-animation-of-ocean-waves-from-underwater-with-floating-plankton-light-rays.mp4","");
        addVideo("http://ak2.picdn.net/shutterstock/videos/4147426/preview/stock-footage-surfer-on-blue-ocean-wave-getting-barreled.mp4","");
        addVideo("http://ak3.picdn.net/shutterstock/videos/5889806/preview/stock-footage-rough-sea-loop-3d-a-loop-of-big-waves-in-an-agitated-ocean-camera-goes-underwater-several-times-4k.mp4","");
        addVideo("http://ak6.picdn.net/shutterstock/videos/4470491/preview/stock-footage-a-young-woman-with-a-slender-figure-is-engaged-in-gymnastics-at-sea-at-sunrise-she-makes-a-run.mp4","");
        addVideo("http://ak3.picdn.net/shutterstock/videos/2474963/preview/stock-footage-ocean-fly-over-hd-high-speed-animation-just-above-the-ocean-waves-facing-the-sun.mp4","");
        addVideo("http://ak7.picdn.net/shutterstock/videos/5584481/preview/stock-footage-ocean-waves-storm-sea-spray.mp4","");
        addVideo("http://ak6.picdn.net/shutterstock/videos/3805313/preview/stock-footage-amazing-sunset-over-the-tropical-beach.mp4","");
        addVideo("http://ak8.picdn.net/shutterstock/videos/3816974/preview/stock-footage-underwater-angle-of-tropical-blue-ocean-wave-breaking.mp4","");
        addVideo("http://ak8.picdn.net/shutterstock/videos/6596987/preview/stock-footage-high-contrast-pov-shot-of-silhouetted-surfer-as-he-rides-through-the-barrel-of-a-dark-orange-wave.mp4","");
        addVideo("http://ak1.picdn.net/shutterstock/videos/5197214/preview/stock-footage-young-man-kitesurfing-in-ocean-extreme-summer-sport-hd-slow-motion.mp4","");
        
        getVideo(list[0], play);
        
        /// start loop
        render();
    
    }
    
    function play(){
    
        var video = (isVideo1 === false ? video1 : video2),
            next = current;
    
        isVideo1 = !isVideo1;
    
        next++;
        if (next > list.length - 1) next = 0;
        
        if (list.length > 0) getVideo(list[next]);
            
        /// start video
        video.play();
        isPlaying = true;
        
        current = next;
    }
    
    function render() {
        if (isPlaying) {
            var video = (isVideo1 === true ? video1 : video2);
            ctx.drawImage(video, 0, 0, w, h);
            ctx.drawImage(wm, 8, 8);
        }
        requestAnimationFrame(render);
    }
    
    function addVideo(urlMP4, url) {
        list.push({
            urlMP4: urlMP4,
            url: url,
            isReady: false
        })
    }
    
    function onTrackedVideoFrame(currentTime, duration){
        
       // Every 15 to 250ms, or whenever the media controller position changes, whichever happens least often
       // The user agent queues a task to fire a simple event named timeupdate at the MediaController.
       // Current time is printed to the developer console when each event is fired along with full duration of the video
       
       console.log(currentTime);
       console.log(duration);
       
       // If no video_preview_duration is set, then the entire duration of each video is used for playback
       
           if (video_preview_duration < 0)
                video_preview_duration = duration;
                
       // In this function, the current time is compared to the target video_preview_duration
       // If the video_preview_duration threshold is met then the video player advances to the next video in the playlist
                
           if (currentTime >= video_preview_duration) {
                
                var video = (isVideo1 === false ? video1 : video2),
                next = current;
                isVideo1 = !isVideo1;
            
                next++;
                if (next > list.length - 1) next = 0;
                
                if (list.length > 0) getVideo(list[next]);
                    
                /// start video
                video.play();
                isPlaying = true;
                
                current = next;
                
                console.log("skipped to next video");
                console.log(list[next]); 
           }
      }
      
    function getVideo(vid, callback) {
    
        var video = (isVideo1 === false ? video1 : video2),
            me = this;
    
        video.addEventListener('canplay', canPlay, false);;
        
        function canPlay(e) {
            video.removeEventListener('canplay', canPlay, false);
            vid.isReady = true;
            if (typeof callback === 'function')
                callback(vid);
        }
    
        if (video.canPlayType("video/mp4").replace('no', '').length > 0) {
            video.src = vid.urlMP4;
        } else {
            video.src = vid.url;
        }
    }
    
});
    
</script>
</head>

<body>
<center>
<canvas id="viewport" width = '640' height = '360'></canvas>
</center>

</body>

</html>
