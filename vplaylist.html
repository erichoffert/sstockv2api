<!doctype html>
<html lang="en">
<head>
    
   <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
   <meta charset="utf-8" />
   <title>HTML5 video search playlist</title>
   <script>
   var videoPlayer;
   var video_preview_duration = -1;
   var music_playback = -1;
   var video_count = 0;
   var video_item = 0;
   var video_playlist = [];
   var music_playlist;
   var media_search_in_progress = true;
   var keyword;
   var ocean_playlist = 
   ["http://ak8.picdn.net/shutterstock/videos/3711827/preview/stock-footage-high-quality-looping-animation-of-ocean-waves-from-underwater-with-floating-plankton-light-rays.mp4",
   "http://ak2.picdn.net/shutterstock/videos/4147426/preview/stock-footage-surfer-on-blue-ocean-wave-getting-barreled.mp4",
   "http://ak3.picdn.net/shutterstock/videos/5889806/preview/stock-footage-rough-sea-loop-3d-a-loop-of-big-waves-in-an-agitated-ocean-camera-goes-underwater-several-times-4k.mp4",
   "http://ak6.picdn.net/shutterstock/videos/4470491/preview/stock-footage-a-young-woman-with-a-slender-figure-is-engaged-in-gymnastics-at-sea-at-sunrise-she-makes-a-run.mp4",
   "http://ak3.picdn.net/shutterstock/videos/2474963/preview/stock-footage-ocean-fly-over-hd-high-speed-animation-just-above-the-ocean-waves-facing-the-sun.mp4",
   "http://ak7.picdn.net/shutterstock/videos/5584481/preview/stock-footage-ocean-waves-storm-sea-spray.mp4",
   "http://ak6.picdn.net/shutterstock/videos/3805313/preview/stock-footage-amazing-sunset-over-the-tropical-beach.mp4",
   "http://ak8.picdn.net/shutterstock/videos/3816974/preview/stock-footage-underwater-angle-of-tropical-blue-ocean-wave-breaking.mp4",
   "http://ak8.picdn.net/shutterstock/videos/6596987/preview/stock-footage-high-contrast-pov-shot-of-silhouetted-surfer-as-he-rides-through-the-barrel-of-a-dark-orange-wave.mp4",
   "http://ak1.picdn.net/shutterstock/videos/5197214/preview/stock-footage-young-man-kitesurfing-in-ocean-extreme-summer-sport-hd-slow-motion.mp4"]
   var waterfall_playlist = 
   ["http://ak9.picdn.net/shutterstock/videos/5882156/preview/stock-footage-extremely-high-pov-cliff-jump-into-water-above-a-waterfall-trees-and-rocks-below-on-a-beautiful.mp4",
   "http://ak4.picdn.net/shutterstock/videos/2208901/preview/stock-footage-close-approach-to-waterfall-by-boat-milford-sound-fjord-south-island-new-zealand.mp4",
   "http://ak9.picdn.net/shutterstock/videos/4080727/preview/stock-footage-waterfalls-fps-lm-slow-motion-x.mp4",
   "http://ak8.picdn.net/shutterstock/videos/3363962/preview/stock-footage-a-river-flows-over-rocks-in-this-beautiful-scene-in-the-tennessee-mountains-in-autumn.mp4",
   "http://ak1.picdn.net/shutterstock/videos/5463350/preview/stock-footage-waterfall-river-paradise-rapids-a-scenic-view-over-a-large-waterfall-rapids-rush-over-the-edge-of.mp4",
   "http://ak3.picdn.net/shutterstock/videos/5462669/preview/stock-footage-waterfall-river-paradise-trees-a-sweeping-view-over-a-large-waterfall-rapids-rush-over-the-edge.mp4",
   "http://ak0.picdn.net/shutterstock/videos/2693297/preview/stock-footage-mountain-stream-in-the-forest.mp4",
   "http://ak3.picdn.net/shutterstock/videos/3915752/preview/stock-footage-slow-motion-shot-of-a-natural-waterfall-shot-in-scotland-uk.mp4",
   "http://ak8.picdn.net/shutterstock/videos/909853/preview/stock-footage-flowing-water-and-wave-time-laps-looping-color-slow-motion.mp4",
   "http://ak7.picdn.net/shutterstock/videos/2988964/preview/stock-footage-a-dolly-shot-of-horseshoe-falls-in-tasmania-australia.mp4"]
   var rocket_playlist = 
   ["http://ak8.picdn.net/shutterstock/videos/5761580/preview/stock-footage-rocket-takeoff.mp4",
   "http://ak2.picdn.net/shutterstock/videos/3399314/preview/stock-footage-beautiful-flight-through-space-to-the-earth-hd.mp4",
   "http://ak7.picdn.net/shutterstock/videos/3757637/preview/stock-footage-rocket-launch.mp4",
   "http://ak4.picdn.net/shutterstock/videos/3936710/preview/stock-footage--s-apollo-lifts-off-from-the-launchpad.mp4",
   "http://ak8.picdn.net/shutterstock/videos/6068675/preview/stock-footage-space-station-and-space-shuttle-orbiting-earth-d-animation.mp4",
   "http://ak5.picdn.net/shutterstock/videos/5277893/preview/stock-footage-an-astronaut-stationed-at-the-international-space-station-goes-on-a-spacewalk.mp4",
   "http://ak0.picdn.net/shutterstock/videos/6167486/preview/stock-footage-space-shuttle-solid-rocket-boosters-separation-d-animation.mp4",
   "http://ak6.picdn.net/shutterstock/videos/7118395/preview/stock-footage-space-shuttle-launch-d-animation.mp4",
   "http://ak7.picdn.net/shutterstock/videos/6389657/preview/stock-footage-carrier-rocket-takes-off-d-animation.mp4",
   "http://ak1.picdn.net/shutterstock/videos/2334638/preview/stock-footage-military-drone-uav-flying-over-desert-and-actively-seeking-enemy-targets.mp4"]
   var waterfall_music = "http://picdn.net/shutterstock/audio/146192/preview/fairytale_love.mp3";
   var ocean_music = "http://picdn.net/shutterstock/audio/27449/preview/come_on_gotta_surf.mp3";
   var rocket_music = "http://picdn.net/shutterstock/audio/200786/preview/live_from_space.mp3";
    
    $( document ).ready(function() {
        
        // When the document is ready (page starts loading), execute this function
        
        // Support the ability to specify a video clip duration in the URL query string and parse it into location.search
        // location.search[1] contains the duration as an integer in seconds, format is URI?n where n = seconds

        // if (location.search != "") 
        //    video_preview_duration = location.search[1];
        
        video_preview_duration = getQueryVariable("t");
        keyword = getQueryVariable("k");
        if (keyword === "ocean") {
            //video_playlist = ocean_playlist;
            music_playlist = ocean_music;
        }
        else if (keyword === "waterfall") {
            //video_playlist = waterfall_playlist;
            music_playlist = waterfall_music;
        }
        else if (keyword === "rocket") {
            //video_playlist = rocket_playlist;
            music_playlist = rocket_music;
        }
        else {
            //video_playlist = ocean_playlist;
            music_playlist = ocean_music;
        }
        
        var opts = "query=" + keyword + "&page=1&per_page=10&safe=true";
  
        console.log(opts);
        
        // Search for video that matches 'keyword' and populate the video_playlist[] array with results
        
        search(opts, 'video');
        while (media_search_in_progress) {
            ;
        }
        
        console.log('completed search, first video =');
        console.log(video_playlist[0]);

        // Initialize the videoPlayer attributes for the <video> tag
        // Attach the "ontimeupdate" event listener which is called multiple times a second 

        videoPlayer = document.getElementById('homevideo');
        videoPlayer.src = video_playlist[0];
        videoPlayer.width = '640';
        videoPlayer.height = '360';
        videoPlayer.autoplay = 'true';
        videoPlayer.autobuffer = 'true';
        videoPlayer.controls = 'true';
        videoPlayer.muted = 'true';
        videoPlayer.ontimeupdate = function() {onTrackedVideoFrame()};
        
        if (getQueryVariable("m") > 0) {
            music_playback = getQueryVariable("m");
        }
        
        if (music_playback > 0) console.log("music playback");
        console.log(music_playback);
            
        if (music_playback > 0) {
            audioPlayer = document.getElementById('homeaudio');
            audioPlayer.src = music_playlist;
            audioPlayer.autoplay = 'true';
            audioPlayer.loop = 'true';
        }

    });
    
   window.onload = function (){ 
       
       // When the document is completely loaded, execute this function
       // This function can be used for a "full video playback" scenario only

        var time_interval = 'Each video plays for time = ' + video_preview_duration + ' seconds';
        
        //window.alert(document.getElementsByClassName('overlay')[0].textContent);
       //document.getElementsByClassName('overlay')[0].textContent=time_interval;
       
       // In this function, a callback is triggered to advance to the next video when the current video completes
       // This is the default behavior without a query string specified

       videoPlayer = document.getElementById('homevideo');
       videoPlayer.addEventListener("ended", function (){
           video_count++;
           if (video_count == 10) video_count = 0;
           var nextVideo = video_playlist[video_count];
           videoPlayer.src = nextVideo;
       }, false);
   }
   
   function createVideoComponent(video) {
       
       //   createVideoComponent(video) sets the video stream file for each video item in the video search
       //   the video stream url is added to the video_playlist[] array which is accessed when the document is ready
       
        var video_preview = 'large';
     
        if (video_preview === 'small') {
          video_preview_url = video.assets.thumb_mp4.url;
        }
        else if (video_preview === 'large') {
          video_preview_url = video.assets.preview_mp4.url;
        }
        
        video_playlist[video_item] = video_preview_url;
        
        console.log(video_playlist[video_item]);
        
        video_item++;
        
      }
      
    function createAudioComponent(audio) {

    }
     
    function createImageComponent(image) {

    }
      
    function search(opts, media_type) {
        
        //  search(opts,media_type) uses Ajax to make an https call to retrieve media search results
        
        var clientId = "2f710067f5b04f443fea";
        var clientSecret = "5db3d2861d48d9ffe4c7134944823900eff34560";
        
        var createComponentFunc;
        
        if (media_type === 'image') {
            createComponentFunc = createImageComponent;
        }
        else if (media_type === 'video') {
            createComponentFunc = createVideoComponent;
        }
        else
            createComponentFunc = createAudioComponent;
            
        //  set the media_url for search
        
        var media_url;
        if (media_type === 'image')
            media_url = 'https://api.shutterstock.com/v2/' + media_type + 's/search';
        else if (media_type === 'video')
            media_url = 'https://api.shutterstock.com/v2/' + media_type + 's/search';
        else
            media_url = 'https://api.shutterstock.com/v2/' + media_type + '/search';
        
        var jqxhr = $.ajax({
            url: media_url,
            data: opts,
            headers: {
            // Base 64 encode 'client_id:client_secret', use Client ID and Client Secret for the Authorization header
            Authorization: 'Basic ' + window.btoa(clientId + ':' + clientSecret)
            }
        })
        .done(function(data) {
            if (data.total_count === 0) {
            console.log('search: no  results');
            return;
            }
            $.each(data.data, function(i, item) {
            console.log('search: processing data item');
            console.log(i);
            var component = createComponentFunc(item);
            });
            media_search_in_progress = false;
            console.log('media search completed');
        })
        .fail(function(xhr, status, err) {
            alert('Failed to retrieve ' + media_type + ' search results:\n' + JSON.stringify(xhr.responseJSON, null, 2));
        });
        
        return jqxhr;
    }

      
    function onTrackedVideoFrame(){
        
       // Every 15 to 250ms, or whenever the media controller position changes, whichever happens least often
       // The user agent queues a task to fire a simple event named timeupdate at the MediaController.
       // Current time is printed to the developer console when each event is fired along with full duration of the video

       console.log(videoPlayer.duration);
       console.log(videoPlayer.currentTime);
       
       // If no video_preview_duration is set, then the entire duration of each video is used for playback
       
           if (video_preview_duration < 0)
                video_preview_duration = videoPlayer.duration;
                
       // In this function, the current time is compared to the target video_preview_duration
       // If the video_preview_duration threshold is met then the video player advances to the next video in the playlist
                
           if (videoPlayer.currentTime >= video_preview_duration) {
                video_count++;
                if (video_count == 10) video_count = 0;
                var nextVideo = video_playlist[video_count];
                videoPlayer.src = nextVideo;
                
                console.log("skip to next video");
                console.log(videoPlayer.src); 
           }
      }
      
    function getQueryVariable(variable) {
    var query = window.location.search.substring(1);
    var vars = query.split('&');
    for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split('=');
        if (decodeURIComponent(pair[0]) == variable) {
            return decodeURIComponent(pair[1]);
        }
    }
    console.log('Query variable %s not found', variable);
}
      
    window.onclick = clickAction;
    
    function clickAction() {
        window.alert(time_interval);
    }

   

   </script>
   
   <style>
   
    body {
    font-family: 'Arimo', sans-serif;
    }

    video {
    position: fixed;
    right: 0;
    bottom: 0;
    min-width: 100%;
    min-height: 100%;
    width: auto;
    height: auto;
    z-index: -100;
    background-size: cover;
    }
    
    /*****************************/
    
    .overlay {
      width: 275px;
      height: 275px;
      border-radius: 50%;
      -webkit-border-radius: 50%;
      -moz-border-radius: 50%;
      background: rgba(0,0,0,0.3);
      display: block;
      position: absolute;
      top: 5%;
      left: 70%;
    }
    
    .overlay h1 {
      text-align: center;
      padding-top: 50px;
      color: #fff;
      font-family: inherit;
    }
    
    .overlay p{
      text-align: center;
      width: 80%;
      margin: 0 auto;
      color: #fff;
      font-family: inherit;
      margin-bottom: 20px;
    }
    
    .overlay a {
      color: #fff;
    }
    
    .overlay_text p {
      text-align: center;
      width: 80%;
      margin: 0 auto;
      color: #fff;
      font-family: inherit;
      margin-bottom: 20px;
    }
    
    .orange {
      text-decoration: none;
    }
     p a.orange {
       color: #f27950;
     }
</style>
  
  <!-- An HTML5 transparent text overlay is rendered on top of the video -->
  
  <div class="overlay">
    <h1>Video Search Playlist</h1>
    <p>Set clip length dynamically</p>
  </div>
    
</head>
<body>

<!-- Code adapted from http://stackoverflow.com/questions/16339181/html5-video-video-playlist -->

<center>
<video id="homevideo"></video>
<audio id="homeaudio"></audio>
</center>

</body>
</html>
